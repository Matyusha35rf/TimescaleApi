# TimescaleApi

WebAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å timescale –¥–∞–Ω–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV —Ñ–∞–π–ª–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–û–ø–∏—Å–∞–Ω–∏–µ](#description)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#technologies)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#architecture)
- [–ú–µ—Ç–æ–¥—ã API](#api-methods)
- [–§–æ—Ä–º–∞—Ç CSV](#csv-format)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#installation)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#testing)
- [–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](#data-models)
- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#features)

## <a name="description"></a>üìù –û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CSV —Ñ–∞–π–ª–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏, –∏—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î –∏ —Ä–∞—Å—á–µ—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫.

## <a name="technologies"></a>üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- .NET 10
- ASP.NET Core Web API
- Entity Framework Core 10
- PostgreSQL
- Swagger / OpenAPI
- xUnit (—Ç–µ—Å—Ç—ã)

## <a name="architecture"></a>üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ 3 —Å–ª–æ—è:

```
TimescaleApi/
‚îú‚îÄ‚îÄ WebApi/          # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, middleware, DI
‚îú‚îÄ‚îÄ BusinessLogic/   # –°–µ—Ä–≤–∏—Å—ã, DTO, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ DataAccess/      # DbContext, –º–æ–¥–µ–ª–∏, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îî‚îÄ‚îÄ TimescaleApi.Tests/ # Unit-—Ç–µ—Å—Ç—ã
```

## <a name="api-methods"></a>üåê –ú–µ—Ç–æ–¥—ã API

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ CSV —Ñ–∞–π–ª–∞
```http
POST /api/CsvFileUpload
```
–ó–∞–≥—Ä—É–∂–∞–µ—Ç CSV —Ñ–∞–π–ª, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î.

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
```http
GET /api/results?fileName=...&avgValueFrom=...
```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ:
- –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
- –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç—ã –ø–µ—Ä–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –¥–∏–∞–ø–∞–∑–æ–Ω—É —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –¥–∏–∞–ø–∞–∑–æ–Ω—É —Å—Ä–µ–¥–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –∑–Ω–∞—á–µ–Ω–∏–π
```http
GET /api/values/{fileName}/last-ten
```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 10 —Å–∞–º—ã—Ö –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

## <a name="csv-format"></a>üìÑ –§–æ—Ä–º–∞—Ç CSV
```csv
Date;ExecutionTime;Value
2024-01-15T08-30-00.0000Z;2.5;100.5
```
- **Date**: –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `–ì–ì–ì–ì-–ú–ú-–î–îT—á—á-–º–º-—Å—Å.–º–º–º–ºZ`
- **ExecutionTime**: –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (double)
- **Value**: –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å (double)

## <a name="installation"></a>üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- .NET 10 SDK
- PostgreSQL (–∏–ª–∏ Docker)

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
git clone https://github.com/Matyusha35rf/TimescaleApi.git
cd TimescaleApi
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î (Docker)
```bash
docker run --name timescale-postgres -e POSTGRES_PASSWORD=12345 -e POSTGRES_DB=TimescaleDb -p 5432:5432 -d postgres
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–í `WebApi/appsettings.json`:
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Database=TimescaleDb;Username=postgres;Password=12345"
  }
}
```

### 4. –ú–∏–≥—Ä–∞—Ü–∏–∏
```bash
dotnet ef database update --project DataAccess --startup-project WebApi
```

### 5. –ó–∞–ø—É—Å–∫
```bash
dotnet run --project WebApi
```

Swagger UI: `https://localhost:5001/swagger`

## <a name="testing"></a>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
dotnet test
```

## <a name="data-models"></a>üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### ValueRecord (—Ç–∞–±–ª–∏—Ü–∞ Values)
- `Id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `FileName` - –∏–º—è —Ñ–∞–π–ª–∞
- `Date` - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `ExecutionTime` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `Value` - –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å
- `CreatedAt` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

### Result (—Ç–∞–±–ª–∏—Ü–∞ Results)
- `Id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `FileName` - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
- `TimeDeltaSeconds` - –¥–µ–ª—å—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- `FirstOperationDate` - –¥–∞—Ç–∞ –ø–µ—Ä–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- `AverageExecutionTime` - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `AverageValue` - —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `MedianValue` - –º–µ–¥–∏–∞–Ω–∞
- `MaxValue` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `MinValue` - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- `CreatedAt` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

## <a name="features"></a>‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó
- –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DTO –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- Unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Å–ª–æ—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
